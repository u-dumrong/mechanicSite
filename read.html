<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customizable Text-to-Speech</title>
</head>
<body>
    <h1>Upload and Listen to TXT File</h1>
    <input type="file" id="fileInput" accept=".txt"><br><br>

    <label for="language">Language: </label>
    <select id="language">
        <option value="en-US">English (US)</option>
        <option value="th-TH">Thai</option>
        <option value="es-ES">Spanish</option>
        <option value="fr-FR">French</option>
        <option value="ja-JP">Japanese</option>
    </select><br><br>

    <label for="rate">Speed (Rate): </label>
    <input type="range" id="rate" min="0.5" max="2" step="0.1" value="1"><br><br>

    <label for="voiceSelect">Voice: </label>
    <select id="voiceSelect"></select><br><br>

    <button id="speakButton" disabled>Read Aloud</button>

    <script>
        let fileContent = ''; // ตัวแปรเก็บข้อความ
        const synth = window.speechSynthesis;
        const voiceSelect = document.getElementById('voiceSelect');
        const languageSelect = document.getElementById('language');
        const rateInput = document.getElementById('rate');

        // โหลดเสียงที่รองรับ
        function populateVoiceList() {
            const voices = synth.getVoices();
            voiceSelect.innerHTML = '';
            voices.forEach(voice => {
                const option = document.createElement('option');
                option.textContent = `${voice.name} (${voice.lang})`;
                option.value = voice.name;
                voiceSelect.appendChild(option);
            });
        }
        populateVoiceList();
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoiceList;
        }

        // อ่านไฟล์ที่อัปโหลด
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    fileContent = e.target.result;
                    document.getElementById('speakButton').disabled = false;
                };
                reader.readAsText(file);
            }
        });

        // อ่านออกเสียง
        document.getElementById('speakButton').addEventListener('click', function() {
            if (fileContent && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(fileContent);
                utterance.lang = languageSelect.value; // เลือกภาษา
                utterance.rate = rateInput.value; // ปรับความเร็ว
                const selectedVoiceName = voiceSelect.value;
                const voices = synth.getVoices();
                const selectedVoice = voices.find(voice => voice.name === selectedVoiceName);
                if (selectedVoice) {
                    utterance.voice = selectedVoice; // ตั้งค่าเสียง
                }
                speechSynthesis.speak(utterance);
            } else {
                alert('Please select a valid file and ensure your browser supports speech synthesis.');
            }
        });
    </script>
</body>
</html>
